{% extends 'base_app.html' %}
{% block title %}ChatGPT – {{ app_name }}{% endblock %}
{% block content %}
<h1 class="text-2xl font-semibold mb-4">ChatGPT</h1>

<form method="post" class="bg-white border rounded-xl p-4 mb-4" novalidate>
  {# CSRF: prefer WTForms hidden_tag; fall back to global csrf_token() #}
  {% if form is defined and form.hidden_tag is defined %}
    {{ form.hidden_tag() }}
  {% else %}
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
  {% endif %}

  {# Global/field errors #}
  {% if form is defined and form.errors %}
    <div class="mb-3 p-3 rounded border border-red-300 bg-red-50 text-red-700 text-sm">
      Please fix the errors below.
    </div>
  {% endif %}

  <label for="prompt" class="block text-sm font-medium text-gray-700 mb-1">Prompt</label>
  {# WTForms will populate value automatically; pass classes/a11y props #}
  {% if form is defined and form.prompt is defined %}
    {{ form.prompt(
        id="prompt",
        rows=5,
        placeholder="Describe what you want to generate…",
        class="w-full border rounded px-3 py-2 mb-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"
    ) }}
    {% if form.prompt.errors %}
      <p class="text-sm text-red-600 mt-1">{{ form.prompt.errors[0] }}</p>
    {% endif %}
  {% else %}
    <textarea
      id="prompt"
      name="prompt"
      rows="5"
      placeholder="Describe what you want to generate…"
      class="w-full border rounded px-3 py-2 mb-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"
      required
    >{{ request.form.get('prompt','') }}</textarea>
  {% endif %}

  <button
    type="submit"
    class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500"
  >
    Send
  </button>
</form>

{% if response is none and request.method == "POST" %}
  <div class="flex items-center space-x-2 text-gray-500">
    <i class="fa-solid fa-spinner fa-spin"></i>
    <span>Waiting for AI response…</span>
  </div>
{% endif %}

{% if response %}
  <div class="bg-white border rounded-xl p-4">
    <div class="text-sm text-gray-500 mb-2">Response</div>
    <div class="whitespace-pre-wrap">{{ response }}</div>
  </div>
{% endif %}
{% endblock %}
