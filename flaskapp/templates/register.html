{% extends 'base_public.html' %}
{% block title %}Create Account – {{ app_name }}{% endblock %}
{% block content %}
<div class="w-full max-w-md mx-auto bg-white border rounded-xl p-6 md:p-8">
  <h1 class="text-2xl font-bold mb-1">Create your account</h1>
  <p class="text-gray-600 mt-1">You'll be done in under a minute.</p>

  <form method="post" class="mt-6 space-y-4" novalidate id="register-form">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <input type="hidden" name="next" value="{{ next or request.args.get('next','') }}">
    <!-- simple honeypot -->
    <input type="text" name="company" tabindex="-1" autocomplete="off" class="hidden" aria-hidden="true">

    <div>
      <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Name</label>
      <input
        id="name"
        name="name"
        type="text"
        inputmode="text"
        autocomplete="name"
        required
        value="{{ request.values.get('name','') }}"
        class="w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"
        placeholder="Jane Contractor"
      >
    </div>

    <div>
      <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
      <input
        id="email"
        name="email"
        type="email"
        inputmode="email"
        autocomplete="email"
        required
        value="{{ request.values.get('email','') }}"
        class="w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"
        placeholder="you@business.com"
      >
    </div>

    <div>
      <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
      <input
        id="password"
        name="password"
        type="password"
        autocomplete="new-password"
        required
        minlength="12"
        class="w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"
        placeholder="••••••••"
      >
      <div class="mt-2 space-y-1">
        <div class="flex items-center gap-2 text-xs">
          <span id="pwd-check-length" class="text-gray-400">○</span>
          <span class="text-gray-600">At least 12 characters</span>
        </div>
        <div class="flex items-center gap-2 text-xs">
          <span id="pwd-check-upper" class="text-gray-400">○</span>
          <span class="text-gray-600">One uppercase letter</span>
        </div>
        <div class="flex items-center gap-2 text-xs">
          <span id="pwd-check-lower" class="text-gray-400">○</span>
          <span class="text-gray-600">One lowercase letter</span>
        </div>
        <div class="flex items-center gap-2 text-xs">
          <span id="pwd-check-number" class="text-gray-400">○</span>
          <span class="text-gray-600">One number</span>
        </div>
        <div class="flex items-center gap-2 text-xs">
          <span id="pwd-check-symbol" class="text-gray-400">○</span>
          <span class="text-gray-600">One symbol (!@#$%^&*...)</span>
        </div>
      </div>
      <p class="text-xs text-gray-500 mt-2 italic">You'll receive a verification email after registration.</p>
    </div>

    <button
      id="register-submit"
      type="submit"
      class="w-full px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"
    >
      Create account
    </button>
  </form>

  <p class="text-sm text-gray-600 mt-4">
    Already have an account?
    <a href="{{ url_for(ep('login'), next=request.args.get('next','')) }}" class="text-indigo-600 hover:underline">Sign in</a>
  </p>
</div>

<script>
  // Prevent double-submits
  const rForm = document.getElementById('register-form');
  const rBtn  = document.getElementById('register-submit');
  rForm?.addEventListener('submit', () => {
    if (rBtn) {
      rBtn.disabled = true;
      rBtn.textContent = 'Creating...';
    }
  });

  // Real-time password validation
  const pwdInput = document.getElementById('password');
  const checks = {
    length: document.getElementById('pwd-check-length'),
    upper: document.getElementById('pwd-check-upper'),
    lower: document.getElementById('pwd-check-lower'),
    number: document.getElementById('pwd-check-number'),
    symbol: document.getElementById('pwd-check-symbol')
  };

  function validatePassword() {
    if (!pwdInput) return;

    const pwd = pwdInput.value;
    const validation = {
      length: pwd.length >= 12,
      upper: /[A-Z]/.test(pwd),
      lower: /[a-z]/.test(pwd),
      number: /[0-9]/.test(pwd),
      symbol: /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(pwd)
    };

    // Update each indicator
    Object.keys(validation).forEach(key => {
      const indicator = checks[key];
      if (!indicator) return;

      if (validation[key]) {
        indicator.textContent = '✓';
        indicator.classList.remove('text-gray-400');
        indicator.classList.add('text-green-600', 'font-semibold');
      } else {
        indicator.textContent = '○';
        indicator.classList.remove('text-green-600', 'font-semibold');
        indicator.classList.add('text-gray-400');
      }
    });
  }

  if (pwdInput) {
    pwdInput.addEventListener('input', validatePassword);
  }
</script>
{% endblock %}
